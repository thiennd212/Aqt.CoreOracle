---
description: 
globs: **/Aqt.CoreOracle.Web/**/*.cs
alwaysApply: false
---
# Rule: Chuáº©n hÃ³a táº§ng Aqt.CoreOracle.Web

## Context

Táº§ng `Web` lÃ  nÆ¡i triá»ƒn khai UI, xá»­ lÃ½ Razor Page, MVC Controller, JavaScript interop hoáº·c layout, menu,...  
Táº§ng nÃ y cÃ³ thá»ƒ dÃ¹ng Ä‘á»ƒ giao tiáº¿p vá»›i Application layer hoáº·c HttpApi layer Ä‘á»ƒ hiá»ƒn thá»‹ dá»¯ liá»‡u.

## Requirements

### ğŸ“ Cáº¥u trÃºc thÆ° má»¥c

- âœ… PhÃ¢n chia theo module: `Pages/Orders`, `Views/Shared`
- âœ… CÃ³ thá»ƒ chá»©a Razor Pages (`.cshtml`) vÃ  code-behind (`.cshtml.cs`)
- âŒ KhÃ´ng nÃªn chá»©a logic nghiá»‡p vá»¥
- âŒ KhÃ´ng nÃªn xá»­ lÃ½ database, repository táº¡i Ä‘Ã¢y

### ğŸ“¦ Namespace

- âœ… Dáº¡ng: `Aqt.CoreOracle.Web.Pages.[Module]`
- âŒ KhÃ´ng láº«n vá»›i `Application`, `Domain`

### ğŸ§­ Giao diá»‡n ngÆ°á»i dÃ¹ng (UI)

- âœ… Sá»­ dá»¥ng Razor Pages (khÃ´ng dÃ¹ng MVC Controller trong dá»± Ã¡n nÃ y)
- âœ… Sá»­ dá»¥ng `PageModel` hoáº·c `ViewModel` rÃµ rÃ ng
- âœ… DÃ¹ng service Ä‘Æ°á»£c inject (`AppService`) Ä‘á»ƒ gá»i dá»¯ liá»‡u
- âŒ KhÃ´ng gá»i trá»±c tiáº¿p `DbContext` hoáº·c `Repository`

### ğŸ§© Menu & Navigation

- âœ… Sá»­ dá»¥ng `IMenuContributor` Ä‘á»ƒ thÃªm má»¥c menu
- âœ… Sá»­ dá»¥ng localization cho label menu (`L["Orders"]`)
- âœ… Group menu theo module

### ğŸ’¬ Localization & Resources

- âœ… Sá»­ dá»¥ng `L["Key"]` cho táº¥t cáº£ ná»™i dung hiá»ƒn thá»‹
- âœ… KhÃ´ng hardcode chuá»—i trong giao diá»‡n Razor

### ğŸ§¾ Using Ä‘Ãºng namespace

Trong Razor Page vÃ  cÃ¡c class á»Ÿ táº§ng Web, cáº§n `using` Ä‘Ãºng cÃ¡c namespace sau Ä‘á»ƒ truy cáº­p AppService, DTO, Permissions, Constants, Enum, v.v.

| Loáº¡i dá»¯ liá»‡u          | Namespace máº«u                                               |
|-----------------------|-------------------------------------------------------------|
| AppService interface  | `Aqt.CoreOracle.Application.Contracts.[Module]`             |
| DTO                   | `Aqt.CoreOracle.Application.Contracts.[Module].Dtos`        |
| Enum (dÃ¹ng trong UI)  | `Aqt.CoreOracle.Domain.Shared.Enums`                        |
| Permission            | `Aqt.CoreOracle.Permissions`                                |
| Setting name constant | `Aqt.CoreOracle.Settings`                                   |
| Localization Resource | `Aqt.CoreOracle.Localization`                               |

ğŸ“Œ VÃ­ dá»¥:
```csharp
using Aqt.CoreOracle.Application.Contracts.Orders;
using Aqt.CoreOracle.Application.Contracts.Orders.Dtos;
using Aqt.CoreOracle.Domain.Shared.Enums;
using Aqt.CoreOracle.Permissions;
using Aqt.CoreOracle.Settings;
using Aqt.CoreOracle.Localization;
```

> âŒ KhÃ´ng using trá»±c tiáº¿p cÃ¡c class táº§ng `Domain`, `Repository`, `DbContext` tá»« Web


### âš ï¸ Ghi chÃº kiáº¿n trÃºc Razor Pages

Dá»± Ã¡n nÃ y **chá»‰ sá»­ dá»¥ng Razor Pages 100% cho táº§ng Web**.  
- âŒ KhÃ´ng sá»­ dá»¥ng MVC Controller trong `Aqt.CoreOracle.Web`
- âœ… Má»i UI Ä‘á»u pháº£i dÃ¹ng Razor Page (`.cshtml` + `PageModel`)
- âœ… Cáº¥u trÃºc module UI theo `Pages/[Module]`
- âœ… Äiá»u hÆ°á»›ng, hiá»ƒn thá»‹, tÆ°Æ¡ng tÃ¡c dá»¯ liá»‡u Ä‘á»u pháº£i thÃ´ng qua Razor Page

ğŸ“Œ Äiá»u nÃ y phÃ¹ há»£p vá»›i:
- LeptonX Razor Theme (UI Razor Pages)
- Kiáº¿n trÃºc hÆ°á»›ng UI server-side
- Dá»… maintain vÃ  cáº¥u hÃ¬nh routing tá»± Ä‘á»™ng

> Náº¿u cáº§n expose REST API â†’ hÃ£y dÃ¹ng táº§ng `HttpApi`, khÃ´ng viáº¿t controller trong Web.


### ğŸ¨ Quáº£n lÃ½ JS/CSS trong Razor Pages

Táº§ng Web sá»­ dá»¥ng Razor Pages cÃ³ thá»ƒ khai bÃ¡o vÃ  sá»­ dá»¥ng JS/CSS theo module.  
âœ… Má»—i module cÃ³ thá»ƒ cÃ³ tá»‡p riÃªng trong `wwwroot/js/` vÃ  `wwwroot/css/`.

#### âœ… Quy táº¯c:
- âœ… Táº¡o thÆ° má»¥c con theo module trong `wwwroot`
- âœ… Äáº·t tÃªn file rÃµ rÃ ng theo tÃ­nh nÄƒng hoáº·c page (VD: `orders-list.js`, `products-form.js`)
- âœ… DÃ¹ng `abpBundlingOptions` Ä‘á»ƒ Ä‘Äƒng kÃ½ bundle
- âœ… DÃ¹ng tag `<abp-script>` vÃ  `<abp-style>` trong `.cshtml`

#### ğŸ“ Cáº¥u trÃºc vÃ­ dá»¥:
```
wwwroot/
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ orders/
â”‚   â”‚   â””â”€â”€ orders-list.js
â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ orders/
â”‚   â”‚   â””â”€â”€ orders-style.css
```

ğŸ“Œ Sá»­ dá»¥ng trong Razor Page:
```html
<abp-style src="/css/orders/orders-style.css" />
<abp-script src="/js/orders/orders-list.js" />
```

> âŒ KhÃ´ng nhÃºng trá»±c tiáº¿p script vÃ o giá»¯a `.cshtml`  
> âŒ KhÃ´ng dÃ¹ng inline `<script>` vÃ  `<style>` náº¿u cÃ³ thá»ƒ trÃ¡nh

### ğŸ§¾ Sá»­ dá»¥ng ABP Dynamic Form

ABP cung cáº¥p thÃ nh pháº§n `abp-dynamic-form` Ä‘á»ƒ tá»± Ä‘á»™ng render form tá»« DTO mÃ  khÃ´ng cáº§n viáº¿t thá»§ cÃ´ng tá»«ng input.  
PhÃ¹ há»£p khi dÃ¹ng vá»›i cÃ¡c `CreateUpdateDto` hoáº·c input model cÃ³ nhiá»u field láº·p láº¡i.

#### âœ… CÃ¡ch sá»­ dá»¥ng:
- âœ… DTO pháº£i cÃ³ `DataAnnotations` nhÆ° `[Required]`, `[StringLength]`, v.v.
- âœ… Trong `.cshtml`, dÃ¹ng `<abp-dynamic-form model="Model.XXX" />`
- âœ… CÃ³ thá»ƒ káº¿t há»£p `abp-button`, `abp-modal`, `abp-input`, v.v.

#### ğŸ“Œ VÃ­ dá»¥:
```html
<abp-dynamic-form model="Model.Order">
    <abp-button type="submit" text="@L["Save"]" />
</abp-dynamic-form>
```

```csharp
public class CreateUpdateOrderDto
{
    [Required]
    [StringLength(64)]
    public string Code { get; set; }

    [Required]
    public DateTime Date { get; set; }
}
```

#### âŒ KhÃ´ng nÃªn:
- âŒ DÃ¹ng dynamic form náº¿u form cáº§n layout phá»©c táº¡p, custom nhiá»u
- âŒ DÃ¹ng náº¿u khÃ´ng cÃ³ DTO chuáº©n hÃ³a báº±ng annotation

> ğŸ§  Dynamic form giÃºp giáº£m láº·p láº¡i, nhÆ°ng khÃ´ng thay tháº¿ Ä‘Æ°á»£c form viáº¿t tay trong cÃ¡c case Ä‘áº·c biá»‡t.


### ğŸ§© Partial / Tag Helpers tÃ¹y chá»‰nh

- âœ… Táº¡o `_*.cshtml` Ä‘á»ƒ lÃ m layout nhá» tÃ¡i sá»­ dá»¥ng (VD: `_StatusBadge.cshtml`)
- âœ… Äáº·t á»Ÿ `Pages/Shared` hoáº·c `Pages/[Module]/Partials`
- âœ… DÃ¹ng `@await Html.PartialAsync("_StatusBadge", model.Status)` Ä‘á»ƒ gá»i

### âœ… Validation UI

- âœ… Sá»­ dá»¥ng `[Required]`, `[StringLength]`, ... trong DTO Ä‘á»ƒ ABP auto validation
- âœ… Razor Page cáº§n `@Html.ValidationSummary()` hoáº·c `abp-validation-summary`
- âŒ KhÃ´ng custom JS validator trá»« khi tháº­t sá»± cáº§n

ğŸ“Œ VÃ­ dá»¥:
```html
<abp-dynamic-form model="Model.Order" />
<abp-validation-summary />
```

### ğŸ”” Toast / Notification UI

- âœ… DÃ¹ng `abp.notify.success("Saved successfully")` hoáº·c `abp.message.confirm(...)`
- âœ… Viáº¿t JS gá»i `abp.notify` sau submit thÃ nh cÃ´ng
- âœ… CÃ³ thá»ƒ cáº¥u hÃ¬nh `abp.ui.setBusy()` khi submit

ğŸ“Œ VÃ­ dá»¥:
```javascript
abp.notify.success("LÆ°u thÃ nh cÃ´ng");
abp.message.success("XoÃ¡ thÃ nh cÃ´ng");
```

> ğŸ“¢ Nhá»¯ng tÃ­nh nÄƒng nÃ y giÃºp nÃ¢ng cao tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng nhÆ°ng váº«n tuÃ¢n theo chuáº©n ABP.


### ğŸ” Sá»­ dá»¥ng AutoMapper giá»¯a ViewModel vÃ  DTO

Trong Razor Page, báº¡n nÃªn sá»­ dá»¥ng `ObjectMapper.Map<>()` Ä‘á»ƒ chuyá»ƒn Ä‘á»•i giá»¯a `DTO` vÃ  `ViewModel`.

#### âœ… Quy táº¯c:
- âœ… KhÃ´ng truyá»n DTO trá»±c tiáº¿p sang UI náº¿u khÃ´ng cáº§n táº¥t cáº£ trÆ°á»ng
- âœ… Táº¡o `ViewModel` riÃªng khi form phá»©c táº¡p hoáº·c muá»‘n phÃ¢n tÃ¡ch logic UI
- âœ… DÃ¹ng `ObjectMapper.Map<DTO, ViewModel>()` Ä‘á»ƒ map sang giao diá»‡n
- âœ… DÃ¹ng `ObjectMapper.Map<ViewModel, DTO>()` Ä‘á»ƒ map láº¡i trÆ°á»›c khi gá»i AppService
- âŒ KhÃ´ng map thá»§ cÃ´ng báº±ng cÃ¡ch gÃ¡n tá»«ng property náº¿u cÃ³ thá»ƒ trÃ¡nh

ğŸ“Œ VÃ­ dá»¥:

```csharp
public class OrderDto
{
    public Guid Id { get; set; }
    public string Code { get; set; }
    public decimal Total { get; set; }
}

public class OrderViewModel
{
    public string Code { get; set; }
}
```

```csharp
public class EditModel : CoreOraclePageModel
{
    public OrderViewModel Order { get; set; }

    public async Task OnGetAsync(Guid id)
    {
        var dto = await _orderAppService.GetAsync(id);
        Order = ObjectMapper.Map<OrderDto, OrderViewModel>(dto);
    }

    public async Task<IActionResult> OnPostAsync()
    {
        var dto = ObjectMapper.Map<OrderViewModel, CreateUpdateOrderDto>(Order);
        await _orderAppService.UpdateAsync(dto);
        return NoContent();
    }
}
```


## Examples

### âœ… VÃ­ dá»¥ Ä‘Ãºng

// âœ… Razor Page gá»i AppService
namespace Aqt.CoreOracle.Web.Pages.Orders;

public class IndexModel : CoreOraclePageModel
{
    private readonly IOrderAppService _orderAppService;

    public List<OrderDto> Orders { get; set; }

    public IndexModel(IOrderAppService orderAppService)
    {
        _orderAppService = orderAppService;
    }

    public async Task OnGetAsync()
    {
        Orders = await _orderAppService.GetListAsync();
    }
}

// âœ… Menu contributor
public class CoreOracleMenuContributor : IMenuContributor
{
    public Task ConfigureMenuAsync(MenuConfigurationContext context)
    {
        var l = context.GetLocalizer<CoreOracleResource>();
        var menu = context.Menu;

        menu.AddItem(new ApplicationMenuItem("Orders", l["Orders"], "/Orders"));
        return Task.CompletedTask;
    }
}
