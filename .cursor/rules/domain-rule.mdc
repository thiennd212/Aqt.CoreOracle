---
description: 
globs: **/Aqt.CoreOracle.Domain/**/*.cs
alwaysApply: false
---
# Rule: Chuáº©n hÃ³a táº§ng Aqt.CoreOracle.Domain theo ABP Framework + DDD

## Context

Táº§ng `Aqt.CoreOracle.Domain` lÃ  trung tÃ¢m nghiá»‡p vá»¥ cá»§a há»‡ thá»‘ng, nÆ¡i Ä‘á»‹nh nghÄ©a cÃ¡c `Entity`, `AggregateRoot`, `DomainService`, `DomainEvent`, vÃ  logic xá»­ lÃ½ nghiá»‡p vá»¥ cá»‘t lÃµi.  
TuÃ¢n thá»§ Ä‘Ãºng chuáº©n giÃºp dá»… báº£o trÃ¬, kiá»ƒm thá»­, má»Ÿ rá»™ng, vÃ  káº¿t ná»‘i hiá»‡u quáº£ vá»›i táº§ng háº¡ táº§ng (EF Core) vÃ  Application.

## Requirements

### ğŸ“ Cáº¥u trÃºc thÆ° má»¥c

- âœ… TÃ¡ch rÃµ thÆ° má»¥c `Entities/`, `Events/`, `Services/`, `Enums/`
- âŒ KhÃ´ng gá»™p chung toÃ n bá»™ class vÃ o thÆ° má»¥c gá»‘c

ğŸ“Œ Gá»£i Ã½ cáº¥u trÃºc:
```
Aqt.CoreOracle.Domain/
â”œâ”€â”€ Orders/
â”‚   â”œâ”€â”€ Entities/
â”‚   â”œâ”€â”€ Services/
â”‚   â”œâ”€â”€ Events/
â”‚   â””â”€â”€ Enums/
```

### ğŸ“¦ Namespace

- âœ… Theo format: `Aqt.CoreOracle.Domain.[Module].[Layer]`
- âŒ KhÃ´ng dÃ¹ng namespace láº«n `Application`, `Web`

ğŸ“Œ VÃ­ dá»¥ chuáº©n:
```csharp
namespace Aqt.CoreOracle.Domain.Orders.Entities;
```

### ğŸ§¬ Káº¿ thá»«a base class

- âœ… DÃ¹ng `AggregateRoot<TKey>` cho root
- âœ… DÃ¹ng `Entity<TKey>` cho sub-entity
- âœ… DÃ¹ng `AuditedEntity<TKey>`, `FullAuditedEntity<TKey>` náº¿u cáº§n tracking
- âœ… DÃ¹ng `ValueObject` cho dá»¯ liá»‡u báº¥t biáº¿n
- âœ… Æ¯u tiÃªn sá»­ dá»¥ng FullAudited
- âŒ KhÃ´ng viáº¿t POCO khÃ´ng káº¿ thá»«a gÃ¬

#### âœ”ï¸ NÃªn dÃ¹ng:

| TrÆ°á»ng há»£p              | Base class              |
|-------------------------|-------------------------|
| Äá»‘i tÆ°á»£ng root (Order)  | AggregateRoot<Guid>     |
| Sub-entity (OrderLine)  | Entity<Guid>            |
| Cáº§n audit + soft-delete | FullAuditedEntity<Guid> |
| KhÃ´ng cáº§n tracking      | Entity<Guid>            |
| GiÃ¡ trá»‹ báº¥t biáº¿n        | ValueObject             |

### ğŸ§  Domain Service

- âœ… TÃªn class káº¿t thÃºc báº±ng `Service`
- âœ… KhÃ´ng cÃ³ field (stateless)
- âŒ KhÃ´ng dÃ¹ng tÃªn nhÆ° `Helper`, `Manager`
- âŒ KhÃ´ng inject `DbContext`, `AppService`

#### âœ”ï¸ NÃªn táº¡o khi:
- Xá»­ lÃ½ logic nhiá»u entity (cross-entity)
- KhÃ´ng biáº¿t nÃªn Ä‘áº·t logic vÃ o Entity nÃ o

#### âŒ KhÃ´ng nÃªn táº¡o khi:
- Logic chá»‰ liÃªn quan Ä‘áº¿n 1 Entity â†’ nÃªn Ä‘Æ°a vÃ o Entity

### ğŸ“¢ Domain Event

- âœ… TÃªn class káº¿t thÃºc báº±ng `Event`
- âœ… Káº¿ thá»«a `DomainEvent`
- âœ… Gá»i `AddDomainEvent(...)` trong `AggregateRoot`
- âŒ KhÃ´ng raise tá»« `AppService`

#### âœ”ï¸ NÃªn dÃ¹ng khi:
- Cáº§n trigger tÃ¡c vá»¥ phá»¥ nhÆ° gá»­i email, ghi log
- Cáº§n theo dÃµi hÃ nh vi nghiá»‡p vá»¥

### ğŸ—ƒï¸ Repository Interface

Repository Interface lÃ  há»£p Ä‘á»“ng truy cáº­p dá»¯ liá»‡u cho cÃ¡c Aggregate hoáº·c Entity, vÃ  lÃ  pháº§n quan trá»ng cá»§a táº§ng Domain.

- âœ… Interface Repository tÃ¹y chá»‰nh pháº£i Ä‘áº·t trong `Aqt.CoreOracle.Domain.[Module]`
- âœ… TÃªn pháº£i báº¯t Ä‘áº§u báº±ng `I` vÃ  káº¿t thÃºc báº±ng `Repository` (VD: `IOrderRepository`)
- âœ… Káº¿ thá»«a tá»« `IRepository<TEntity, TKey>` cá»§a ABP Framework
- âŒ KhÃ´ng Ä‘Æ°á»£c implement táº¡i Domain
- âŒ KhÃ´ng Ä‘Æ°á»£c chá»©a logic hoáº·c method cÃ³ thÃ¢n (`{}`)

#### âœ”ï¸ NÃªn táº¡o khi:
- Cáº§n bá»• sung method query Ä‘áº·c thÃ¹ cho má»™t Entity
- Domain cáº§n Ä‘á»‹nh nghÄ©a rÃµ yÃªu cáº§u truy cáº­p dá»¯ liá»‡u

#### âŒ KhÃ´ng nÃªn táº¡o khi:
- ChÆ°a rÃµ Aggregate hoáº·c yÃªu cáº§u dá»¯ liá»‡u chÆ°a á»•n Ä‘á»‹nh
- DÃ¹ng Ä‘á»ƒ viáº¿t xá»­ lÃ½ logic â†’ sai vai trÃ²

### ğŸ§¾ Using Ä‘Ãºng namespace

Cáº§n `using` Ä‘Ãºng cÃ¡c namespace sau Ä‘á»ƒ truy cáº­p Permissions, Setting, Localization

| Loáº¡i dá»¯ liá»‡u          | Namespace máº«u                                               |
|-----------------------|-------------------------------------------------------------|
| Permission            | `Aqt.CoreOracle.Permissions`                                |
| Setting name constant | `Aqt.CoreOracle.Settings`                                   |
| Localization Resource | `Aqt.CoreOracle.Localization`                               |

ğŸ“Œ VÃ­ dá»¥:
```csharp
using Aqt.CoreOracle.Permissions;
using Aqt.CoreOracle.Settings;
using Aqt.CoreOracle.Localization;
```

## Examples
<example>
```csharp
// âœ… AggregateRoot
namespace Aqt.CoreOracle.Domain.Orders.Entities;

public class Order : AggregateRoot<Guid>
{
    public void Complete()
    {
        Status = OrderStatus.Completed;
        AddDomainEvent(new OrderCompletedEvent(Id));
    }
}

// âœ… DomainService
namespace Aqt.CoreOracle.Domain.Orders.Services;

public class PricingService
{
    public decimal Calculate(Order order) => order.Total * 0.9m;
}

// âœ… DomainEvent
namespace Aqt.CoreOracle.Domain.Orders.Events;

public class OrderCompletedEvent : DomainEvent
{
    public Guid OrderId { get; }
    public OrderCompletedEvent(Guid orderId) => OrderId = orderId;
}
```
</example>

<example type="invalid">
```csharp
// âŒ KhÃ´ng káº¿ thá»«a base class
public class Order { public Guid Id { get; set; } }

// âŒ Public setter
public class Product : AggregateRoot<Guid>
{
    public string Name { get; set; } // âŒ NÃªn dÃ¹ng private set
}

// âŒ DomainService cÃ³ state
public class DiscountService
{
    private decimal _rate = 0.1m;
    public decimal Calc(Order order) => order.Total * (1 + _rate);
}

// âŒ Raise event tá»« AppService
public class OrderAppService : ApplicationService
{
    public void Complete(Guid id)
    {
        var order = _repo.Get(id);
        AddDomainEvent(new OrderCompletedEvent(id));
    }
}
```
</example>

<example>
```csharp
// âœ… Interface Repository chuáº©n
namespace Aqt.CoreOracle.Domain.Orders;

public interface IOrderRepository : IRepository<Order, Guid>
{
    Task<List<Order>> GetRecentAsync(int count);
}
```
</example>

<example type="invalid">
```csharp
// âŒ Repository Ä‘áº·t sai táº§ng
namespace Aqt.CoreOracle.Domain.Shared.Repositories;

public interface IOrderRepository { } // âŒ NÃªn Ä‘áº·t á»Ÿ Domain/Orders

// âŒ Interface cÃ³ logic xá»­ lÃ½
public interface IOrderRepository
{
    List<Order> GetAll() => new(); // âŒ KhÃ´ng Ä‘Æ°á»£c viáº¿t thÃ¢n hÃ m
}
```
</example>